;SPDX-License-Identifier: MIT
(load "init-util.repl")

(begin-tx)
(load "../contracts/poseidon-constants.pact")
(load "../contracts/poseidon.pact")

(print (format "poseidon-constants: {}\nposeidon-hash: {}" (map (compose (describe-module) (at 'hash))
                                                           ["poseidon-constants-v1","poseidon-hash-v1-1" ])))

(commit-tx)

(begin-tx)
(use poseidon-hash-v1-1)

; Size 0
(expect-failure "Hash of []" "Unsupported" (poseidon-hash []))

; Size 1
(expect "Hash of [0]" 19014214495641488759237505126948346942972912379615652741039992445865937985820 (poseidon-hash [0]))
(expect "Hash of [n]" 5531577314068399026062012915499220227443825847435558783988252536753307525992 (poseidon-hash [19014214495641488759237505126948346942972912379615652741039992445865937985820]))
(expect "Hash of [P-1]" 3366645945435192953002076803303112651887535928162668198103357554665518664470 (poseidon-hash [21888242871839275222246405745257275088548364400416034343698204186575808495616]))

; Size 2
(expect "Hash of [0 0]" 14744269619966411208579211824598458697587494354926760081771325075741142829156 (poseidon-hash [0 0 ]))
(expect "Hash of [1 2]" 7853200120776062878684798364095072458815029376092732009249414926327459813530 (poseidon-hash [1 2 ]))
(expect "Hash of [n n]" 747279621027876355256554829174589888295137165884148783805917062031617857394 (poseidon-hash [19014214495641488759237505126948346942972912379615652741039992445865937985820 14744269619966411208579211824598458697587494354926760081771325075741142829156]))
(expect "Hash of [P-1, P-1]" 20092309280547939997162506796691455192771288143174894022739895715370814071035 (poseidon-hash [21888242871839275222246405745257275088548364400416034343698204186575808495616 21888242871839275222246405745257275088548364400416034343698204186575808495616]))

; Size 3
(expect "Hash of [0 0 0]" 5317387130258456662214331362918410991734007599705406860481038345552731150762 (poseidon-hash [0 0 0]))
(expect "Hash of [999 999 999]" 15710323634138803504609804384914458496740837782812808851290976833991475732919 (poseidon-hash [999 999 999]))

; Size 4
(expect "Hash of [0 0 0 0 ]" 2351654555892372227640888372176282444150254868378439619268573230312091195718 (poseidon-hash [0 0 0 0]))
(expect "Hash of [1 2 3 4]" 18821383157269793795438455681495246036402687001665670618754263018637548127333 (poseidon-hash [1 2 3 4]))
(expect "Hash of [999 999 999 999]" 2375827817640782336807319098052243333146010749437055704266974936413173018445 (poseidon-hash [999 999 999 999]))

;Size 5
(expect "Hash of [0 0 0 0 0]" 14655542659562014735865511769057053982292279840403315552050801315682099828156 (poseidon-hash [0 0 0 0 0]))
(expect "Hash of [999 999 999 999 999]" 21390095853018326452624823908557419432703348858971792932082190464681708269449 (poseidon-hash [999 999 999 999 999]))

; Size 6
(expect-failure "Hash of [0 0 0 0 0 0]" "Unsupported" (poseidon-hash [0 0 0 0 0 0]))

(print "Looks like everything is working as expected for Poseidon !")
