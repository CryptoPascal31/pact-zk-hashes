;SPDX-License-Identifier: MIT
(load "init-util.repl")

(begin-tx)
(load "../contracts/mimc-constants.pact")
(load "../contracts/mimc.pact")
(commit-tx)

(begin-tx)
(use mimc-v1)

(expect "Single Hash Test 1: {1,2}" {'L:18444058245820418255538785847032978363886102372504864086197416499869253008979,
                                     'R:2646733164649743153031645792459389637917704265581895142760676293265176296759}
                                    (feistel-hash 3 {'L:1, 'R:2}))


(expect "Single Hash Test 2: {xxx,xxx}" {'L:2366086960588067715776571462946544584857872152005464708653195316407814692421,
                                         'R:5111378774380223279588325810344599589963263858403398810755719442194306865062}
                                        (feistel-hash 53 {'L:274945154732293792784580363548970818611304339008964723447672490026510689427,
                                                          'R:274945154732293792784580363548970818611304339008964723447672490026510689427}))


; Multi hashss
(expect-failure "Hash empty imput" "not be empty" (feistel-multi-hash 3 [] 1))

(expect-failure "Hash empty output" "is required" (feistel-multi-hash 3 [0] 0))

(expect "Multi Hash 1 Input/1 Output" [8426254928183433017674806292814795928093069860681963309360233295796225841846]
                                      (feistel-multi-hash 3 [1] 1))

(expect "Multi Hash 1 Input/3 Outputs" [20230481682314396134855132249196125268056847919849104001796590882623326426015,
                                        3810079710190174739469889500061154613646368121667559426175382162195873745927,
                                        6863047375598332922604837469448693522698476622650182444464029910076789430236]
                                      (feistel-multi-hash 3 [2646733164649743153031645792459389637917704265581895142760676293265176296759] 3))

(expect "Multi Hash 3 Input/1 Output" [21885518433956853981107653007145799810790061020610893874234826926585880304298]
                                      (feistel-multi-hash 3 [2646733164649743153031645792459389637917704265581895142760676293265176296759,
                                                             4973738421587359054488902919855050324241918924179724620637034345288144142083,
                                                             15220077988570443367731199009786661560185446709948397754752745152177564662199] 1))

(print "Looks like everything is working as expected !")
